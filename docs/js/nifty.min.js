!function(){"use strict";var e,t,r,a,l,o,s,c,n,i,d,u,g,h,f,p,k=(e={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"},a=function(r){var a=function(){if(!t){var r=JSON.parse(localStorage.getItem("niftyPrefs"));t=r?$.extend({},e,r):e,localStorage.setItem("niftyPrefs",JSON.stringify(t))}return t}();return a&&r?a.hasOwnProperty(r)?t[r]:null:a},{config:t=null,set:function(e,r){(t=a())[e]=r,localStorage.setItem("niftyPrefs",JSON.stringify(t))},get:a,getBool:function(e){var t=a(e);return r(t)},truthy:r=function(e){return"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e)}}),m=(l=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),o(!1);var a=k.get("arrowStyle")||"arrow",l=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+a+" clicked "+l).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},o=function e(t,r){r||t?(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t?(e(!1),l(!1),$(".clicked").removeClass("clicked"),r.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),r.parents("li").addClass("clicked")):r.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},{setArrow:l,setArrowStyle:s=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),k.set("arrowStyle",t)},toggleArrowStyle:function(){var e;"circle"===k.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),s(e)},toggleArrow:function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?l(!1,e):(l(!1),o(!1),l(!0,e))):l(!1)},toggleCheckmark:function(e){return e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},setShortcut:o,toggleShortcut:function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?o(!1,e):(o(!1),o(!0,e))):o(!1)}}),v=(n=function(){var e=k.get("wallpaper");e&&"default"!==e||(e=k.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),i("body.bgimage {background-image: url("+e+")}")},i=function(e){var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},{setDarkMode:u=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=$("body");e?(t.addClass("dark"),k.set("darkMode",1)):(t.removeClass("dark"),k.set("darkMode",0))},toggleDarkMode:function(){var e=$("body").hasClass("dark");u(!e)},setExpose:g=function(e){var t=$("body");e?(t.addClass("expose"),k.set("expose",1)):(t.removeClass("expose"),k.set("expose",0))},toggleExpose:function(){$("body").hasClass("expose")?g(!1):g(!0)},setBG:d=function(e){var t=$("body");e?(t.addClass("bgimage"),k.set("bgImage",1),n()):(t.removeClass("bgimage"),k.set("bgImage",0))},setWallpaper:function(e){k.set("wallpaper",e),n()},loadWallpaper:n,toggleBG:function(){$("body").hasClass("bgimage")?d(!1):d(!0)},clearClicks:c=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),m.setArrow(!1),m.setShortcut(!1),e&&$(".persist").removeClass("persist")},screenshot:function(e){$("body").addClass("screenshot");var t=$(".clicked");if(!t.length)throw"No menu items selected";var r=[];t.each((function(e,t){r.push($(t).find(">strong").text())}));var a=t.last();a.children(".shortcut").length>0?r.push(a.find(".menuitem").text()):r.push(a.text()),r=r.join("-").replace(/-+/g,"-").replace(/ +/g,"_");var l=t.parents("ul").not("body>ul"),o=Math.floor(t.first().offset().left-50),s=150,n=0;l.each((function(e,t){s+=$(t).width();var r=$(t).offset().top,a=$(t).height();r+a>n&&(n=r+a)}));var i=!1,u=k.getBool("bgImage");/url\("http/.test($("body").css("background-image"))?i=!0:/url\("file/.test($("body").css("background-image"))&&d(!1),html2canvas(document.querySelector("body"),{x:o,y:0,width:s,height:n+50,useCORS:i,allowTaint:!1}).then((function(t){if($("#screenshotHolder").empty(),$("#screenshotHolder").append(t),c(!0),$("body").removeClass("screenshot"),d(u),e){var a=$("<div class=screenshot-controls>");$("<button>Cancel</button>").addClass("screenshot-close").on("click",(function(){$("#screenshotHolder").empty()})).appendTo(a),$("<button>Save</button>").addClass("screenshot-dl").data("title",r).on("click",(function(){h(r)})).appendTo(a),a.appendTo("#screenshotHolder")}else h(r)}))},downloadScreenshot:h=function(e){e||(e="NiftyMenu_Screenshot");var t=document.querySelector("#screenshotHolder canvas"),r=document.createElement("a");r.download="".concat(e,".png"),r.href=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r.click(),$("#screenshotHolder").empty()}}),C=(f=function(){var e=prompt("Enter URL for background image");k.set("wallpaper",e),v.loadWallpaper()},p=function(){var e=prompt("Enter optional keywords (comma separated words)"),t="https://source.unsplash.com/random/1900x1200?"+encodeURIComponent(e);k.set("wallpaper",t),v.loadWallpaper()},{itemClick:function(e){e.preventDefault();var t,r=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(r=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?m.toggleCheckmark(t):e.altKey&&(r?m.toggleShortcut(t):m.toggleArrow(t)),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),m.setArrow(!1),m.setShortcut(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(v.clearClicks(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),m.setArrow(!1),m.setShortcut(!1)),!1;m.setArrow(!1),m.setShortcut(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&m.setArrow(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":v.toggleDarkMode();break;case"exposeToggle":v.toggleExpose();break;case"backgroundToggle":v.toggleBG();break;case"chooseWallpaper":f();break;case"randomWallpaper":p();break;case"resetWallpaper":v.setWallpaper(!1);break;case"arrowStyle":m.toggleArrowStyle();break;case"screenshot":v.screenshot(e);break;default:throw"Element ID unrecognized"}return!1},liveSearch:function(e){var t=$(".helpsearch input"),r=t.val(),a=!1;if("Escape"===e.code)return e.preventDefault(),t.val("").blur(),v.clearClicks(!0),!0;if("Enter"!==e.code&&"Return"!==e.code||(e.preventDefault(),$(".persist").removeClass("persist"),a=!0),r.length<2)return v.clearClicks(!1),!0;var l=find(r);return l?(v.clearClicks(!1),l.parents("li").addClass("clicked"),l.addClass("clicked last"),a&&(t.blur(),l.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):v.clearClicks(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),v.clearClicks();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1}}),b=function(){var e,t=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,a=r(),l=fuzzysort.go(e,a);return l.length?(t=l[0].target,$("li").filter((function(e,r){return $(r).data("path")===t})).first()):null},r=function(){if(e&&e.length>0)return e;var t=[];return $("li").each((function(e,r){var a=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(a=t.innerText.split(/\n/)[0].trim()+"/"+a)})),$(r).data("path",a),t.push(a)})),e=t};return{orderedMenuItemTitles:[],init:function(){r(),k.getBool("darkMode")&&v.setDarkMode(!0),k.getBool("expose")&&v.setExpose(!0),v.loadWallpaper(),k.getBool("bgImage")&&v.setBG(!0),m.setArrowStyle(k.get("arrowStyle")),$("body,li").on("click dblclick",C.itemClick),$("span",".controls").on("click",C.controlsClick),$(".helpsearch input").on("keydown",C.liveSearch),$(".helpsearch").on("click",C.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),"ttscoff.github.io"===window.location.host&&$("body").addClass("demo"),Mousetrap.bind("shift+/",C.focusSearch),Mousetrap.bind("shift+d",v.toggleDarkMode),Mousetrap.bind("shift+e",v.toggleExpose),Mousetrap.bind("shift+s",v.screenshot)},click:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&v.clearClicks(!0),e&&!/^\s*$/.test(e)){var a=t(e);a&&(a.click(),a.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else v.clearClicks(!0)},dblClick:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&v.clearClicks(!0),e&&!/^\s*$/.test(e)){var a=t(e);a&&(a.dblclick(),a.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else v.clearClicks(!0)},find:t}}(),w={targetEl:null,config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=k.config,r=$.extend({},t,e);return v.setDarkMode(k.truthy(r.darkMode)),v.setExpose(k.truthy(r.expose)),v.setBG(k.truthy(r.bgImage)),v.setWallpaper(r.wallpaper),m.setArrowStyle(r.arrowStyle),this},find:function(e){return this.targetEl=b.find(e),this},clear:function(){return v.clearClicks(!0),this},lock:function(){return v.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),v.clearClicks(!0),this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout"),this},arrow:function(e){return void 0===e&&(e=!0),m.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),m.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),v.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),v.setExpose(e),this},shoot:function(){return v.screenshot(),this}};$((function(){b.init(),window.NiftyAPI=w}))}();