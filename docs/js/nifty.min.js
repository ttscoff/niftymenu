!function(){"use strict";var e,t,r,l,a,s,o,c,i,n,d,u,g,f,h=(e={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"},l=function(r){var l=function(){if(!t){var r=JSON.parse(localStorage.getItem("niftyPrefs"));t=r?$.extend({},e,r):e,localStorage.setItem("niftyPrefs",JSON.stringify(t))}return t}();return l&&r?l.hasOwnProperty(r)?t[r]:null:l},{config:t=null,set:function(e,r){(t=l())[e]=r,localStorage.setItem("niftyPrefs",JSON.stringify(t))},get:l,getBool:function(e){var t=l(e);return r(t)},truthy:r=function(e){return"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e)}}),k=(a=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),s(!1);var l=h.get("arrowStyle")||"arrow",a=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+l+" clicked "+a).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},s=function e(t,r){r||t?(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t?(e(!1),a(!1),$(".clicked").removeClass("clicked"),r.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),r.parents("li").addClass("clicked")):r.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},{setArrow:a,setArrowStyle:o=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),h.set("arrowStyle",t)},toggleArrowStyle:function(){var e;"circle"===h.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),o(e)},toggleArrow:function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?a(!1,e):(a(!1),s(!1),a(!0,e))):a(!1)},toggleCheckmark:function(e){return e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},setShortcut:s,toggleShortcut:function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?s(!1,e):(s(!1),s(!0,e))):s(!1)}}),p=(c=function(){var e=h.get("wallpaper");e&&"default"!==e||(e=h.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),i("body.bgimage {background-image: url("+e+")}")},i=function(e){var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},{setDarkMode:d=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=$("body");e?(t.addClass("dark"),h.set("darkMode",1)):(t.removeClass("dark"),h.set("darkMode",0))},toggleDarkMode:function(){var e=$("body").hasClass("dark");d(!e)},setExpose:u=function(e){var t=$("body");e?(t.addClass("expose"),h.set("expose",1)):(t.removeClass("expose"),h.set("expose",0))},toggleExpose:function(){$("body").hasClass("expose")?u(!1):u(!0)},setBG:n=function(e){var t=$("body");e?(t.addClass("bgimage"),h.set("bgImage",1),c()):(t.removeClass("bgimage"),h.set("bgImage",0))},setWallpaper:function(e){h.set("wallpaper",e),c()},loadWallpaper:c,toggleBG:function(){$("body").hasClass("bgimage")?n(!1):n(!0)},clearClicks:function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),k.setArrow(!1),k.setShortcut(!1),e&&$(".persist").removeClass("persist")}}),C=(f=function(){var e=prompt("Enter URL for background image");h.set("wallpaper",e),p.loadWallpaper()},{itemClick:function(e){e.preventDefault();var t,r=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(r=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?k.toggleCheckmark(t):e.altKey&&(r?k.toggleShortcut(t):k.toggleArrow(t)),g(),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),k.setArrow(!1),k.setShortcut(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(p.clearClicks(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),k.setArrow(!1),k.setShortcut(!1),g()),!1;k.setArrow(!1),k.setShortcut(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&k.setArrow(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return g(),!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":p.toggleDarkMode();break;case"exposeToggle":p.toggleExpose();break;case"backgroundToggle":p.toggleBG();break;case"chooseWallpaper":f();break;case"resetWallpaper":p.setWallpaper(!1);break;case"arrowStyle":p.toggleArrowStyle();break;default:throw"Element ID unrecognized"}return!1},liveSearch:function(e){var t=$(".helpsearch input"),r=t.val(),l=!1;if("Escape"===e.code)return e.preventDefault(),t.val("").blur(),p.clearClicks(!0),!0;if("Enter"!==e.code&&"Return"!==e.code||(e.preventDefault(),$(".persist").removeClass("persist"),l=!0),r.length<2)return p.clearClicks(!1),!0;var a=find(r);return a?(p.clearClicks(!1),a.parents("li").addClass("clicked"),a.addClass("clicked last"),l&&(t.blur(),a.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):p.clearClicks(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),p.clearClicks();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1},updateStatus:g=function(){return setTimeout((function(){$(".last").length?$("body").addClass("locked"):$("body").removeClass("locked")}),50),!0}}),v=function(){var e,t=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,l=r(),a=fuzzysort.go(e,l);return a.length?(t=a[0].target,$("li").filter((function(e,r){return $(r).data("path")===t})).first()):null},r=function(){if(e&&e.length>0)return e;var t=[];return $("li").each((function(e,r){var l=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(l=t.innerText.split(/\n/)[0].trim()+"/"+l)})),$(r).data("path",l),t.push(l)})),e=t};return{orderedMenuItemTitles:[],init:function(){r(),h.getBool("darkMode")&&p.setDarkMode(!0),h.getBool("expose")&&p.setExpose(!0),p.loadWallpaper(),h.getBool("bgImage")&&p.setBG(!0),k.setArrowStyle(h.get("arrowStyle")),$("body,li").on("click dblclick",C.itemClick),$("span",".controls").on("click",C.controlsClick),$(".helpsearch input").on("keydown",C.liveSearch),$(".helpsearch").on("click",C.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),"ttscoff.github.io"===window.location.host&&$("body").addClass("demo"),Mousetrap.bind("shift+/",C.focusSearch),Mousetrap.bind("shift+d",p.toggleDarkMode),Mousetrap.bind("shift+e",p.toggleExpose)},click:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&p.clearClicks(!0),e&&!/^\s*$/.test(e)){var l=t(e);l&&(l.click(),l.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else p.clearClicks(!0)},dblClick:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&p.clearClicks(!0),e&&!/^\s*$/.test(e)){var l=t(e);l&&(l.dblclick(),l.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else p.clearClicks(!0)},find:t}}(),m={targetEl:null,config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=h.config,r=$.extend({},t,e);return p.setDarkMode(h.truthy(r.darkMode)),p.setExpose(h.truthy(r.expose)),p.setBG(h.truthy(r.bgImage)),p.setWallpaper(r.wallpaper),k.setArrowStyle(r.arrowStyle),this},find:function(e){return this.targetEl=v.find(e),this},clear:function(){return p.clearClicks(!0),this},lock:function(){return p.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),p.clearClicks(!0),this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout"),this},arrow:function(e){return void 0===e&&(e=!0),k.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),k.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),p.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),p.setExpose(e),this}};$((function(){v.init(),window.NiftyAPI=m}))}();