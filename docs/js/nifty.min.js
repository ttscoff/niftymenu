"use strict";var Prefs=function(){var e={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"},t=null,r=function(e){return"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e)},l=function(r){var l=function(){if(!t){var r=JSON.parse(localStorage.getItem("niftyPrefs"));t=r?$.extend({},e,r):e,localStorage.setItem("niftyPrefs",JSON.stringify(t))}return t}();return l&&r?l.hasOwnProperty(r)?t[r]:null:l};return{config:t,set:function(e,r){(t=l())[e]=r,localStorage.setItem("niftyPrefs",JSON.stringify(t))},get:l,getBool:function(e){var t=l(e);return r(t)},truthy:r}}(),Nifty=function(){var e=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var r,l=t(),a=fuzzysort.go(e,l);return a.length?(r=a[0].target,$("li").filter((function(e,t){return $(t).data("path")===r})).first()):null},t=function(){if(b.orderedMenuItemTitles.length>0)return b.orderedMenuItemTitles;var e=[];return $("li").each((function(t,r){var l=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(l=t.innerText.split(/\n/)[0].trim()+"/"+l)})),$(r).data("path",l),e.push(l)})),b.orderedMenuItemTitles=e,b.orderedMenuItemTitles},r=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),a(!1);var l=Prefs.get("arrowStyle")||"arrow",s=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+l+" clicked "+s).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},l=function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?r(!1,e):(r(!1),a(!1),r(!0,e))):r(!1)},a=function e(t,l){l||t?(l instanceof jQuery||(l=$(l)),"LI"!==l.get(0).tagName&&(l=l.parents("li").first()),t?(e(!1),r(!1),$(".clicked").removeClass("clicked"),l.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),l.parents("li").addClass("clicked")):l.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},s=function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?a(!1,e):(a(!1),a(!0,e))):a(!1)},i=function(e){if(!(e instanceof jQuery))if("string"==typeof e){var t=b.find(e);if(!t)return!1;e=t}else e=$(e);return e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},o=function(){return setTimeout((function(){$(".last").length?$("body").addClass("locked"):$("body").removeClass("locked")}),50),!0},n=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),Prefs.set("arrowStyle",t)},c=function(){var e;"circle"===Prefs.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),n(e)},d=function(){var e=prompt("Enter URL for background image");Prefs.set("wallpaper",e),f()},u=function(e){Prefs.set("wallpaper",e),f()},f=function(){var e=Prefs.get("wallpaper");e&&"default"!==e||(e=Prefs.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),g("body.bgimage {background-image: url("+e+")}")},g=function(e){var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},h=function(e){var t=$("body");e?(t.addClass("bgimage"),Prefs.set("bgImage",1),f()):(t.removeClass("bgimage"),Prefs.set("bgImage",0))},k=function(){$("body").hasClass("bgimage")?h(!1):h(!0)},p=function(){$("body");var e=$("body").hasClass("dark");v(!e)},v=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=$("body");e?(t.addClass("dark"),Prefs.set("darkMode",1)):(t.removeClass("dark"),Prefs.set("darkMode",0))},y=function(e){var t=$("body");e?(t.addClass("expose"),Prefs.set("expose",1)):(t.removeClass("expose"),Prefs.set("expose",0))},C=function(){$("body").hasClass("expose")?y(!1):y(!0)},m=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),r(!1),a(!1),e&&$(".persist").removeClass("persist")},b={orderedMenuItemTitles:[],init:function(){t(),Prefs.get()},click:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&b.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=b.find(e);r&&(r.click(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else b.util.clearClicks(!0)},dblClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&b.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=b.find(e);r&&(r.dblclick(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else b.util.clearClicks(!0)},find:e,callout:{setArrow:r,setArrowStyle:n,toggleArrowStyle:c,toggleArrow:l,toggleCheckmark:i,setShortcut:a,toggleShortcut:s},handlers:{itemClick:function(e){e.preventDefault();var t,n=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(n=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?i(t):e.altKey&&(n?s(t):l(t)),o(),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),r(!1),a(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(m(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),r(!1),a(!1),o()),!1;r(!1),a(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&r(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return o(),!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":p();break;case"exposeToggle":C();break;case"backgroundToggle":k();break;case"chooseWallpaper":d();break;case"resetWallpaper":u(!1);break;case"arrowStyle":c();break;default:console.info("Element ID unrecognized")}return!1},liveSearch:function(t){var r=$(".helpsearch input"),l=r.val(),a=!1;if("Escape"===t.code)return t.preventDefault(),r.val("").blur(),m(!0),!0;if("Enter"!==t.code&&"Return"!==t.code||(t.preventDefault(),$(".persist").removeClass("persist"),a=!0),l.length<2)return m(!1),!0;var s=e(l);return s?(m(!1),s.parents("li").addClass("clicked"),s.addClass("clicked last"),a&&(r.blur(),s.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):m(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),m();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1},updateStatus:o},util:{setDarkMode:v,toggleDarkMode:p,setExpose:y,toggleExpose:C,setBG:h,setWallpaper:u,loadWallpaper:f,toggleBG:k,clearClicks:m}};return b}(),NiftyAPI={targetEl:null,config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Prefs.config,r=$.extend({},t,e);return Nifty.util.setDarkMode(Prefs.truthy(r.darkMode)),Nifty.util.setExpose(Prefs.truthy(r.expose)),Nifty.util.setBG(Prefs.truthy(r.bgImage)),Nifty.util.setWallpaper(r.wallpaper),Nifty.callout.setArrowStyle(r.arrowStyle),this},find:function(e){return this.targetEl=Nifty.find(e),this},clear:function(){return Nifty.util.clearClicks(!0),this},lock:function(){return Nifty.util.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),Nifty.util.clearClicks(!0),this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout"),this},arrow:function(e){return void 0===e&&(e=!0),Nifty.callout.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),Nifty.callout.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),Nifty.util.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),Nifty.util.setExpose(e),this}};$((function(){Nifty.init(),Prefs.getBool("darkMode")&&Nifty.util.setDarkMode(!0),Prefs.getBool("expose")&&Nifty.util.setExpose(!0),Nifty.util.loadWallpaper(),Prefs.getBool("bgImage")&&Nifty.util.setBG(!0),Nifty.callout.setArrowStyle(Prefs.get("arrowStyle")),$("body,li").on("click dblclick",Nifty.handlers.itemClick),$("span",".controls").on("click",Nifty.handlers.controlsClick),$(".helpsearch input").on("keydown",Nifty.handlers.liveSearch),$(".helpsearch").on("click",Nifty.handlers.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),Mousetrap.bind("shift+/",Nifty.handlers.focusSearch),Mousetrap.bind("shift+d",Nifty.util.toggleDarkMode),Mousetrap.bind("shift+e",Nifty.util.toggleExpose)}));