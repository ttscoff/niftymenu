!function(){"use strict";var e,t,r,a,l,o,s,n,c,i,d,u,g,h,f,p,m,k,v,C=(e="niftyPrefs",t={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"},l=function(a){var l=function(){if(!r){var a=JSON.parse(localStorage.getItem(e));r=a?$.extend({},t,a):t,localStorage.setItem(e,JSON.stringify(r))}return r}();return l&&a?l.hasOwnProperty(a)?r[a]:null:l},{config:r=null,set:function(t,a){(r=l())[t]=a,localStorage.setItem(e,JSON.stringify(r))},get:l,getBool:function(e){var t=l(e);return a(t)},truthy:a=function(e){return"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e)}}),b=(o=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),s(!1);var a=C.get("arrowStyle")||"arrow",l=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+a+" clicked "+l).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},s=function e(t,r){r||t?(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t?(e(!1),o(!1),$(".clicked").removeClass("clicked"),r.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),r.parents("li").addClass("clicked")):r.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},{setArrow:o,setArrowStyle:n=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),C.set("arrowStyle",t)},toggleArrowStyle:function(){var e;"circle"===C.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),n(e)},toggleArrow:function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?o(!1,e):(o(!1),s(!1),o(!0,e))):o(!1)},toggleCheckmark:function(e){return e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},setShortcut:s,toggleShortcut:function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?s(!1,e):(s(!1),s(!0,e))):s(!1)}}),w=(i=function(){var e=C.get("wallpaper");e&&"default"!==e||(e=C.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),d("body.bgimage, body.dark.bgimage {background-image: url("+e+")}")},d=function(e){var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},g=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=$("body");e?(t.addClass("dark"),C.set("darkMode",1)):(t.removeClass("dark"),C.set("darkMode",0)),i()},{setDarkMode:g,toggleDarkMode:function(){var e=$("body").hasClass("dark");g(!e)},setExpose:h=function(e){var t=$("body");e?(t.addClass("expose"),$("html,body").width($("body>ul").width()),C.set("expose",1)):(C.set("expose",0),window.location.reload())},toggleExpose:function(){$("body").hasClass("expose")?h(!1):h(!0)},setBG:u=function(e){var t=$("body");e?(t.addClass("bgimage"),C.set("bgImage",1),i()):(t.removeClass("bgimage"),C.set("bgImage",0))},setWallpaper:function(e){C.set("wallpaper",e),i()},loadWallpaper:i,toggleBG:function(){$("body").hasClass("bgimage")?u(!1):u(!0)},clearClicks:c=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),b.setArrow(!1),b.setShortcut(!1),e&&$(".persist").removeClass("persist")},screenshot:function(e,t){$("body").addClass("screenshot");var r,a=$("li.clicked");if(!a.length)throw"No menu items selected";if(t)r=t;else{r=[],a.each((function(e,t){r.push($(t).find(">strong").text())}));var l=a.last();l.children(".shortcut").length>0?r.push(l.find(".menuitem").text()):r.push(l.text()),r=r.join("-").replace(/-+/g,"-").replace(/ +/g,"_")}var o=a.parents("ul").not("body>ul"),s=Math.floor(a.first().offset().left-70),n=150,i=0;o.each((function(e,t){n+=$(t).width();var r=$(t).offset().top,a=$(t).height();r+a>i&&(i=r+a)})),a.last().find("ul").length&&(n+=a.last().find("ul").width());var d=!1,g=C.getBool("bgImage");/url\("http/.test($("body").css("background-image"))?d=!0:/url\("file/.test($("body").css("background-image"))&&u(!1),html2canvas(document.querySelector("body"),{x:s,y:0,width:n,height:i+50,useCORS:d,imageTimeout:6e4}).then((function(t){if($("#screenshotHolder").empty(),$("#screenshotHolder").append(t),c(!0),$("body").removeClass("screenshot"),u(g),e){var a=$("<div class=screenshot-controls>");$("<button>Cancel</button>").addClass("screenshot-close").on("click",(function(){$("#screenshotHolder").empty()})).appendTo(a),$("<button>Save</button>").addClass("screenshot-dl").data("title",r).on("click",(function(){f(r)})).appendTo(a),a.appendTo("#screenshotHolder")}else f(r)}))},downloadScreenshot:f=function(e){e||(e="NiftyMenu_Screenshot");var t=document.querySelector("#screenshotHolder canvas"),r=document.createElement("a");r.download="".concat(e,".png"),r.href=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r.click(),$("#screenshotHolder").empty()},terminal:function(e){return e.preventDefault(),$("#terminal").length>0?($("#terminal").toggle(),$("#terminal").is(":visible")&&$("#terminal>textarea").focus()):($("<form id=terminal><textarea></textarea><input type=submit value=Run>").appendTo("body"),$("#terminal>input").on("click",(function(e){e.preventDefault();var t=$("#terminal textarea").val();$("#terminal").hide(),t.trim().split(/;/).forEach((function(e){var t=e.trim();if(t.length>0)return Function('"use strict";return ('.concat(t,")"))()}))})),$("#terminal>textarea").focus()),!1}}),y={orderedMenuItemTitles:[],getOrderedMenuItemTitles:m=function(){if(p&&p.length>0)return p;var e=[];return $("li").each((function(t,r){var a=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(a=t.innerText.split(/\n/)[0].trim()+"/"+a)})),$(r).data("path",a),e.push(a)})),p=e},find:function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,r=m(),a=fuzzysort.go(e,r);return a.length?(t=a[0].target,$("li").filter((function(e,r){return $(r).data("path")===t})).first()):null}},S=(k=function(){var e=prompt("Enter URL for background image");C.set("wallpaper",e),w.loadWallpaper()},v=function(){var e=prompt("Enter optional keywords (comma separated words)"),t="https://source.unsplash.com/random/1900x1200?"+encodeURIComponent(e);C.set("wallpaper",t),w.loadWallpaper()},{itemClick:function(e){e.preventDefault();var t,r=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(r=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?b.toggleCheckmark(t):e.altKey&&(r?b.toggleShortcut(t):b.toggleArrow(t)),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),b.setArrow(!1),b.setShortcut(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(w.clearClicks(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),b.setArrow(!1),b.setShortcut(!1)),!1;b.setArrow(!1),b.setShortcut(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&b.setArrow(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":w.toggleDarkMode();break;case"exposeToggle":w.toggleExpose();break;case"backgroundToggle":w.toggleBG();break;case"chooseWallpaper":k();break;case"randomWallpaper":v();break;case"resetWallpaper":w.setWallpaper(!1);break;case"arrowStyle":b.toggleArrowStyle();break;case"screenshot":w.screenshot(e);break;case"commandshell":w.terminal(e);break;default:throw"Element ID unrecognized"}return!1},liveSearch:function(e){var t=$(".helpsearch input"),r=t.val(),a=!1;if("Escape"===e.code)return e.preventDefault(),t.val("").blur(),w.clearClicks(!0),!0;if("Enter"!==e.code&&"Return"!==e.code||(e.preventDefault(),$(".persist").removeClass("persist"),a=!0),r.length<2)return w.clearClicks(!1),!0;var l=y.find(r);return l?(w.clearClicks(!1),l.parents("li")&&l.parents("li").addClass("clicked"),l.addClass("clicked last"),a&&(t.blur(),l.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):w.clearClicks(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),w.clearClicks();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1}}),x={orderedMenuItemTitles:[],init:function(){y.getOrderedMenuItemTitles(),C.getBool("darkMode")&&w.setDarkMode(!0),C.getBool("expose")&&w.setExpose(!0),w.loadWallpaper(),C.getBool("bgImage")&&w.setBG(!0),b.setArrowStyle(C.get("arrowStyle")),$("body,li").on("click dblclick",S.itemClick),$("span",".controls").on("click",S.controlsClick),$(".helpsearch input").on("keyup",S.liveSearch),$(".helpsearch").on("click",S.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),"ttscoff.github.io"===window.location.host&&$("body").addClass("demo"),Mousetrap.bind("shift+/",S.focusSearch),Mousetrap.bind("shift+d",w.toggleDarkMode),Mousetrap.bind("shift+e",w.toggleExpose),Mousetrap.bind("shift+s",w.screenshot),Mousetrap.bind("$",w.terminal)},click:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&w.clearClicks(!0),e&&!/^\s*$/.test(e)){var t=y.find(e);t&&(t.click(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else w.clearClicks(!0)},dblClick:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&w.clearClicks(!0),e&&!/^\s*$/.test(e)){var t=y.find(e);t&&(t.dblclick(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else w.clearClicks(!0)}},M={targetEl:null,getConfig:function(){return C.get()},config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=C.config,r=$.extend({},t,e);return w.setDarkMode(C.truthy(r.darkMode)),w.setBG(C.truthy(r.bgImage)),w.setWallpaper(r.wallpaper),b.setArrowStyle(r.arrowStyle),this},find:function(e){return this.targetEl=y.find(e),this},clear:function(){return w.clearClicks(!0),this},lock:function(){return w.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),w.clearClicks(!0),e&&(this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout")),this},arrow:function(e){return void 0===e&&(e=!0),b.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),b.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),w.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),w.setExpose(e),this},shoot:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return w.screenshot(!1,e),this}};$((function(){x.init(),window.NiftyAPI=M}))}();