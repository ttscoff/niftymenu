"use strict";var Prefs=function(){var e={arrowStyle:"arrow",bgimage:1,expose:0,darkmode:0},r=null,t=function(t){var l=function(){if(!r){var t=JSON.parse(localStorage.getItem("niftyPrefs"));r=t?$.extend({},e,t):e,localStorage.setItem("niftyPrefs",JSON.stringify(r))}return r}();return l&&t?l.hasOwnProperty(t)?r[t]:null:l};return{config:r,set:function(e,l){(r=t())[e]=l,localStorage.setItem("niftyPrefs",JSON.stringify(r))},get:t,getBool:function(e){var r=t(e);return Number(r)?Boolean(Number(r)):!!/(y(es)?|true)/i.test(r)}}}(),Nifty=function(){var e=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,l=r(),s=fuzzysort.go(e,l);return s.length?(t=s[0].target,$("li").filter((function(e,r){return $(r).data("path")===t})).first()):null},r=function(){if(f.orderedMenuItemTitles.length>0)return f.orderedMenuItemTitles;var e=[];return $("li").each((function(r,t){var l=t.innerText.split(/\n/)[0].trim();$(t).parents("li").each((function(e,r){r.innerText.length&&(l=r.innerText.split(/\n/)[0].trim()+"/"+l)})),$(t).data("path",l),e.push(l)})),f.orderedMenuItemTitles=e,f.orderedMenuItemTitles},t=function e(r,t){if(t||r)if(t instanceof jQuery||(t=$(t)),"LI"!==t.get(0).tagName&&(t=t.parents("li").first()),r){e(!1);var l=Prefs.get("arrowStyle")||"arrow",s=t.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),t.addClass("arrow arrow-"+l+" clicked "+s).append("<b><i></i></b>"),t.parents("li").addClass("clicked")}else t.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(r,t){e(!1,$(t))}))},l=function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?t(!1,e):(t(!1),t(!0,e))):t(!1)},s=function(e){if(!(e instanceof jQuery))if("string"==typeof e){var r=f.fuzzyFind(e);if(!r)return!1;e=r}else e=$(e);return e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},a=function(){return setTimeout((function(){$(".last").length?$("body").addClass("locked"):$("body").removeClass("locked")}),50),!0},o=function(e){var r="arrow";e&&"circle"===e?(r="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),Prefs.set("arrowStyle",r)},i=function(){var e;"circle"===Prefs.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),o(e)},c=function(){var e=$("body");e.hasClass("bgimage")?(e.removeClass("bgimage"),Prefs.set("bgimage",0)):(e.addClass("bgimage"),Prefs.set("bgimage",1))},n=function(){var e=$("body");$("body").hasClass("dark")?(e.removeClass("dark"),Prefs.set("darkmode",0)):(e.addClass("dark"),Prefs.set("darkmode",1))},d=function(){var e=$("body");e.hasClass("expose")?(e.removeClass("expose"),Prefs.set("expose",0)):(e.addClass("expose"),Prefs.set("expose",1))},u=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),t(!1),e&&$(".persist").removeClass("persist")},f={orderedMenuItemTitles:[],init:function(){r(),Prefs.get()},click:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&f.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var t=f.fuzzyFind(e);t&&(t.click(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else f.util.clearClicks(!0)},dblClick:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(r&&f.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var t=f.fuzzyFind(e);t&&(t.dblclick(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else f.util.clearClicks(!0)},fuzzyFind:e,callout:{setArrow:t,setArrowStyle:o,toggleArrowStyle:i,toggleArrow:l,toggleCheckmark:s},handlers:{itemClick:function(e){e.preventDefault();var r=$(e.target);if(e.metaKey||e.altKey)return e.metaKey?s(r):e.altKey&&l(r),a(),!1;if($("li.callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),t(!1);else{if(r.hasClass("clicked"))return r.find(".last").length?(u(),r.parents("li").addClass("clicked"),r.addClass("clicked last")):($(".last").removeClass("last"),r.parents(".clicked").length?(r.removeClass("clicked"),r.siblings(".clicked").removeClass("clicked"),r.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),t(!1),a()),!1;t(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),r.parents("li").addClass("clicked"),e.altKey&&t(!0,r),r.addClass("clicked last"),"dblclick"===e.type&&(r.addClass("callout"),e.shiftKey&&r.parents(".clicked").addClass("callout"))}return a(),!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":n();break;case"exposeToggle":d();break;case"backgroundToggle":c();break;case"arrowStyle":i();break;default:console.info("Element ID unrecognized")}return!1},liveSearch:function(r){var t=$(".helpsearch input"),l=t.val(),s=!1;if("Escape"===r.code)return r.preventDefault(),t.val("").blur(),u(!0),!0;if("Enter"!==r.code&&"Return"!==r.code||(r.preventDefault(),$(".persist").removeClass("persist"),s=!0),l.length<2)return u(!1),!0;var a=e(l);return a?(u(!1),a.parents("li").addClass("clicked"),a.addClass("clicked last"),s&&(t.blur(),a.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):u(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),u();var r=$(".helpsearch").first();return r.parents("li").addClass("clicked persist"),r.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",r).focus(),!1},updateStatus:a},util:{setDarkMode:function(e){var r=$("body");e?r.addClass("dark"):r.removeClass("dark")},toggleDarkMode:n,setExpose:function(e){var r=$("body");e?r.addClass("expose"):r.removeClass("expose")},toggleExpose:d,setBG:function(e){var r=$("body");e?r.addClass("bgimage"):r.removeClass("bgimage")},toggleBG:c,clearClicks:u}};return f}();$((function(){Nifty.init(),Prefs.getBool("darkmode")&&Nifty.util.toggleDarkMode(),Prefs.getBool("expose")&&Nifty.util.toggleExpose(),Prefs.getBool("bgimage")&&Nifty.util.toggleBG(),Nifty.callout.setArrowStyle(Prefs.get("arrowStyle")),$("body,li").on("click dblclick",Nifty.handlers.itemClick),$("span",".controls").on("click",Nifty.handlers.controlsClick),$(".helpsearch input").on("keydown",Nifty.handlers.liveSearch),$(".helpsearch").on("click",Nifty.handlers.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),Mousetrap.bind("shift+/",Nifty.handlers.focusSearch),Mousetrap.bind("shift+d",Nifty.util.toggleDarkMode),Mousetrap.bind("shift+e",Nifty.util.toggleExpose)}));