"use strict";var Prefs=function(){var e={arrowStyle:"arrow",bgimage:1,expose:0,darkmode:0},r=null,t=function(t){var l=function(){if(!r){var t=JSON.parse(localStorage.getItem("niftyPrefs"));r=t?$.extend({},e,t):e,localStorage.setItem("niftyPrefs",JSON.stringify(r))}return r}();return l&&t?l.hasOwnProperty(t)?r[t]:null:l};return{config:r,set:function(e,l){(r=t())[e]=l,localStorage.setItem("niftyPrefs",JSON.stringify(r))},get:t,getBool:function(e){var r=t(e);return Number(r)?Boolean(Number(r)):!!/(y(es)?|true)/i.test(r)}}}(),Nifty=function(){var e=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,l=r(),s=fuzzysort.go(e,l);return s.length?(t=s[0].target,$("li").filter(function(e,r){return $(r).data("path")===t}).first()):null},r=function(){if(u.orderedMenuItemTitles.length>0)return u.orderedMenuItemTitles;var e=[];return $("li").each(function(r,t){var l=t.innerText.split(/\n/)[0].trim();$(t).parents("li").each(function(e,r){r.innerText.length&&(l=r.innerText.split(/\n/)[0].trim()+"/"+l)}),$(t).data("path",l),e.push(l)}),u.orderedMenuItemTitles=e,u.orderedMenuItemTitles},t=function e(r,t){if(t||r)if(t instanceof jQuery||(t=$(t)),r){e(!1);var l=Prefs.get("arrowStyle")||"arrow";$(".clicked").removeClass("clicked"),t.addClass("arrow arrow-"+l+" clicked").append("<b><i></i></b>"),t.parents("li").addClass("clicked")}else t.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each(function(r,t){e(!1,$(t))})},l=function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?t(!1,e):(t(!1),t(!0,e))):t(!1)},s=function(e){e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked")},a=function(e){var r="arrow";e&&"circle"===e?(r="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),Prefs.set("arrowStyle",r)},o=function(){var e;"circle"===Prefs.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),a(e)},i=function(){var e=$("body");e.hasClass("bgimage")?(e.removeClass("bgimage"),Prefs.set("bgimage",0)):(e.addClass("bgimage"),Prefs.set("bgimage",1))},c=function(){var e=$("body");$("body").hasClass("dark")?(e.removeClass("dark"),Prefs.set("darkmode",0)):(e.addClass("dark"),Prefs.set("darkmode",1))},n=function(){var e=$("body");e.hasClass("expose")?(e.removeClass("expose"),Prefs.set("expose",0)):(e.addClass("expose"),Prefs.set("expose",1))},d=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),t(!1),e&&$(".persist").removeClass("persist")},u={orderedMenuItemTitles:[],init:function(){r(),Prefs.get()},click:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&u.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=u.fuzzyFind(e);r&&(r.click(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else u.util.clearClicks(!0)},dblClick:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&u.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=u.fuzzyFind(e);r&&(r.dblclick(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else u.util.clearClicks(!0)},fuzzyFind:e,callout:{setArrow:t,setArrowStyle:a,toggleArrowStyle:o,toggleArrow:l,toggleCheckmark:s},handlers:{itemClick:function(e){e.preventDefault();var r=$(e.target);if(e.metaKey)return s(r),!1;if(e.altKey)return l(r),!1;if($("li.callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),t(!1);else{if(r.hasClass("clicked"))return $(".clicked").removeClass("clicked"),t(!1),!1;t(!1),t(!1),$("li.clicked").removeClass("clicked"),r.parents("li").addClass("clicked"),e.altKey&&t(!0,r),r.addClass("clicked"),"dblclick"===e.type&&r.addClass("callout")}return!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":c();break;case"exposeToggle":n();break;case"backgroundToggle":i();break;case"arrowStyle":o();break;default:console.info("Element ID unrecognized")}return!1},liveSearch:function(r){var t=$(".helpsearch input"),l=t.val(),s=!1;if("Escape"===r.code)return r.preventDefault(),t.val("").blur(),d(!0),!0;if("Enter"!==r.code&&"Return"!==r.code||(r.preventDefault(),$(".persist").removeClass("persist"),s=!0),l.length<2)return d(!1),!0;var a=e(l);return a?(d(!1),a.parents("li").addClass("clicked"),a.addClass("clicked"),s&&(t.blur(),a.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):d(!1),!0}},util:{setDarkMode:function(e){var r=$("body");e?r.addClass("dark"):r.removeClass("dark")},toggleDarkMode:c,setExpose:function(e){var r=$("body");e?r.addClass("expose"):r.removeClass("expose")},toggleExpose:n,setBG:function(e){var r=$("body");e?r.addClass("bgimage"):r.removeClass("bgimage")},toggleBG:i,focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),d();var r=$(".helpsearch").first();return r.parents("li").addClass("clicked persist"),r.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",r).focus(),!1},clearClicks:d}};return u}();$(function(){Nifty.init(),Prefs.getBool("darkmode")&&Nifty.util.toggleDarkMode(),Prefs.getBool("expose")&&Nifty.util.toggleExpose(),Prefs.getBool("bgimage")&&Nifty.util.toggleBG(),Nifty.callout.setArrowStyle(Prefs.get("arrowStyle")),$("body,li").on("click dblclick",Nifty.handlers.itemClick),$("span",".controls").on("click",Nifty.handlers.controlsClick),$(".helpsearch input").on("keydown",Nifty.handlers.liveSearch),$(".helpsearch").on("click",Nifty.util.focusSearch),$(".helpsearch").on("blur",function(){$(".persist").removeClass("persist")}),Mousetrap.bind("shift+/",Nifty.util.focusSearch),Mousetrap.bind("shift+d",Nifty.util.toggleDarkMode),Mousetrap.bind("shift+e",Nifty.util.toggleExpose)});