!function(){"use strict";const e=function(){const e="niftyPrefs",t={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"};let l=null;const r=e=>"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e),s=r=>{let s=(()=>{if(!l){let r=JSON.parse(localStorage.getItem(e));l=r?$.extend({},t,r):t,localStorage.setItem(e,JSON.stringify(l))}return l})();return s&&r?s.hasOwnProperty(r)?l[r]:null:s};return{config:l,set:(t,r)=>{l=s(),l[t]=r,localStorage.setItem(e,JSON.stringify(l))},get:s,getBool:e=>{let t=s(e);return r(t)},truthy:r}}(),t=function(){const t=(r,s)=>{if(s||r)if(s instanceof jQuery||(s=$(s)),"LI"!==s.get(0).tagName&&(s=s.parents("li").first()),r){t(!1),l(!1);const r=e.get("arrowStyle")||"arrow",a=s.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),s.addClass("arrow arrow-"+r+" clicked "+a+" last").append("<b><i></i></b>"),s.parents("li").addClass("clicked")}else s.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(e,l){t(!1,$(l))}))},l=(e,r)=>{r||e?(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),e?(l(!1),t(!1),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),r.addClass("clicked last").find(".shortcut").addClass("shortcut-callout"),r.parents("li").addClass("clicked")):r.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(e,t){l(!1,$(t))}))},r=t=>{let l="arrow";t&&"circle"===t?(l="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),e.set("arrowStyle",l)};return{setArrow:t,setArrowStyle:r,toggleArrowStyle:()=>{let t;"circle"===e.get("arrowStyle")?(t="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(t="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),r(t)},toggleArrow:e=>{e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?t(!1,e):(t(!1),l(!1),t(!0,e))):t(!1)},toggleCheckmark:e=>(e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0),setShortcut:l,toggleShortcut:e=>{e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?l(!1,e):(l(!1),l(!0,e))):l(!1)}}}(),l=function(){const l=e=>{$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),t.setArrow(!1),t.setShortcut(!1),e&&$(".persist").removeClass("persist")},r=()=>{let t=e.get("wallpaper");t&&"default"!==t||(t=e.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),s("body.bgimage, body.dark.bgimage {background-image: url("+t+")}")},s=e=>{var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},a=t=>{let l=$("body");t?(l.addClass("bgimage"),e.set("bgImage",1),r()):(l.removeClass("bgimage"),e.set("bgImage",0))},o=function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],l=$("body");t?(l.addClass("dark"),e.set("darkMode",1)):(l.removeClass("dark"),e.set("darkMode",0)),r()},i=t=>{let l=$("body");t?(l.addClass("expose"),$("html,body").width($("body>ul").width()),e.set("expose",1)):(e.set("expose",0),window.location.reload())},n=e=>{e||(e="NiftyMenu_Screenshot");let t=document.querySelector("#screenshotHolder canvas"),l=document.createElement("a");l.download="".concat(e,".png"),l.href=t.toDataURL("image/png").replace("image/png","image/octet-stream"),l.click(),$("#screenshotHolder").empty()};return{setDarkMode:o,toggleDarkMode:()=>{let e=$("body").hasClass("dark");o(!e)},setExpose:i,toggleExpose:()=>{$("body").hasClass("expose")?i(!1):i(!0)},setBG:a,setWallpaper:t=>{e.set("wallpaper",t),r()},loadWallpaper:r,toggleBG:()=>{$("body").hasClass("bgimage")?a(!1):a(!0)},clearClicks:l,screenshot:(t,r)=>{$("body").addClass("screenshot");let s,o=$("li.clicked");if(!o.length)throw"No menu items selected";if(r)s=r;else{s=[],o.each(((e,t)=>{s.push($(t).find(">strong").text())}));let e=o.last();e.children(".shortcut").length>0?s.push(e.find(".menuitem").text()):s.push(e.text()),s=s.join("-").replace(/-+/g,"-").replace(/ +/g,"_")}let i=o.parents("ul").not("body>ul"),c=Math.floor(o.first().offset().left-70),d=150,u=0;i.each(((e,t)=>{d+=$(t).width();let l=$(t).offset().top,r=$(t).height();l+r>u&&(u=l+r)})),o.last().find("ul").length&&(d+=o.last().find("ul").width());let p=!1,g=e.getBool("bgImage");/url\("http/.test($("body").css("background-image"))?p=!0:/url\("file/.test($("body").css("background-image"))&&a(!1),html2canvas(document.querySelector("body"),{x:c,y:0,width:d,height:u+50,useCORS:p,imageTimeout:6e4}).then((e=>{if($("#screenshotHolder").empty(),$("#screenshotHolder").append(e),l(!0),$("body").removeClass("screenshot"),a(g),t){let e=$("<div class=screenshot-controls>");$("<button>Cancel</button>").addClass("screenshot-close").on("click",(()=>{$("#screenshotHolder").empty()})).appendTo(e),$("<button>Save</button>").addClass("screenshot-dl").data("title",s).on("click",(()=>{n(s)})).appendTo(e),e.appendTo("#screenshotHolder")}else n(s)}))},downloadScreenshot:n,terminal:e=>(e.preventDefault(),$("#terminal").length>0?($("#terminal").toggle(),$("#terminal").is(":visible")&&$("#terminal>textarea").focus()):($("<form id=terminal><textarea></textarea><input type=submit value=Run>").appendTo("body"),$("#terminal>input").on("click",(e=>{e.preventDefault();let t=$("#terminal textarea").val();$("#terminal").hide(),t.trim().split(/;/).forEach((e=>{let t=e.trim();if(t.length>0)return Function('"use strict";return ('.concat(t,")"))()}))})),$("#terminal>textarea").focus()),!1)}}(),r=function(){let e;const t=()=>{if(e&&e.length>0)return e;let t=[];return $("li").each((function(e,l){let r=l.innerText.split(/\n/)[0].trim();$(l).parents("li").each((function(e,t){t.innerText.length&&(r=t.innerText.split(/\n/)[0].trim()+"/"+r)})),$(l).data("path",r),t.push(r)})),e=t,e};return{orderedMenuItemTitles:[],getOrderedMenuItemTitles:t,find:e=>{if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");let l=t(),r=fuzzysort.go(e,l);return r.length?(s=r[0].target,$("li").filter((function(e,t){return $(t).data("path")===s})).first()):null;var s}}}(),s=function(){const s="niftyPicsumSeed",a=()=>{let t=prompt("Enter URL for background image");e.set("wallpaper",t),l.loadWallpaper()},o=()=>{const t=localStorage.getItem(s)||"",r=document.createElement("div");r.id="picsumDialogOverlay",r.style.cssText="position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:10000;";const a=document.createElement("form");a.style.cssText="background:#fff;color:#111;padding:1.25rem;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.3);min-width:280px;position:relative;z-index:1;pointer-events:auto;",a.innerHTML=['<p style="margin:0 0 0.75rem;font-weight:600;color:#111;">Picsum background (2400Ã—1350 16:9)</p>','<label style="display:block;margin-bottom:0.5rem;color:#111;"><span style="display:block;font-size:0.85em;color:#666;">Seed (optional, keeps image static)</span><input type="text" id="picsumSeed" name="seed" placeholder="e.g. picsum" style="width:100%;box-sizing:border-box;padding:6px 8px;margin-top:2px;background:#f5f5f5;color:#111;border:1px solid #ddd;"></label>','<div style="margin-bottom:0.75rem;"><label for="picsumBlur" style="display:block;margin-bottom:4px;cursor:pointer;color:#111;">Blur <span id="picsumBlurVal">0</span></label><input type="range" id="picsumBlur" name="blur" min="0" max="10" value="0" style="width:100%;cursor:pointer;"></div>','<label for="picsumGrayscale" style="display:flex;align-items:center;gap:8px;margin-bottom:1rem;cursor:pointer;color:#111;"><input type="checkbox" id="picsumGrayscale" name="grayscale" style="cursor:pointer;"> Grayscale</label>','<div style="display:flex;gap:8px;justify-content:flex-end;"><button type="button" id="picsumCancel">Cancel</button><button type="submit" id="picsumOk">OK</button></div>'].join(""),a.querySelector("#picsumSeed").value=t;const o=a.querySelector("#picsumBlur"),i=a.querySelector("#picsumBlurVal");o.addEventListener("input",(()=>{i.textContent=o.value})),r.appendChild(a),document.body.appendChild(r);const n=()=>{document.body.removeChild(r)};a.addEventListener("click",(e=>e.stopPropagation())),a.querySelector("#picsumCancel").addEventListener("click",n),a.addEventListener("submit",(t=>{t.preventDefault();const r=(a.seed&&a.seed.value?a.seed.value.trim():"")||null,o=parseInt(a.blur.value,10)||0,i=a.grayscale&&a.grayscale.checked;r&&localStorage.setItem(s,r);const c=((e,t,l)=>{const r="2400/1350";let s=e?"seed/"+encodeURIComponent(e)+"/"+r:r,a=[];return l&&a.push("grayscale"),t>0&&a.push("blur"+(t>1?"="+t:"")),"https://picsum.photos/"+s+(a.length?"?"+a.join("&"):"")})(r,o,i);e.set("wallpaper",c),l.loadWallpaper(),n()})),r.addEventListener("click",(e=>{e.target===r&&n()}))},i=()=>{o()};return{itemClick:e=>{if(e.preventDefault(),$(e.target).hasClass("divider"))return!1;let r,s=!1;if("SPAN"===e.target.tagName?(r=$(e.target).closest("li"),($(e.target).hasClass("shortcut")||$(e.target).closest(".shortcut").length)&&(s=!0)):r=$(e.target),r.length&&1===r.children().length&&r.find(".divider").length)return!1;if(e.altKey)return s?t.toggleShortcut(r):t.toggleArrow(r),!1;if(e.metaKey)return t.toggleCheckmark(r),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),t.setArrow(!1),t.setShortcut(!1);else{if(r.hasClass("clicked"))return r.find(".last").length?(l.clearClicks(),r.parents("li").addClass("clicked"),r.addClass("clicked last")):($(".last").removeClass("last"),r.parents(".clicked").length?(r.removeClass("clicked"),r.siblings(".clicked").removeClass("clicked"),r.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),t.setArrow(!1),t.setShortcut(!1)),!1;t.setArrow(!1),t.setShortcut(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),r.parents("li").addClass("clicked"),e.altKey&&t.setArrow(!0,r),r.addClass("clicked last"),"dblclick"===e.type&&(r.addClass("callout"),e.shiftKey&&r.parents(".clicked").addClass("callout"))}return!1},controlsClick:e=>{switch(e.preventDefault(),e.target.id){case"darkModeToggle":l.toggleDarkMode();break;case"exposeToggle":l.toggleExpose();break;case"backgroundToggle":l.toggleBG();break;case"chooseWallpaper":a();break;case"randomWallpaper":i();break;case"resetWallpaper":l.setWallpaper(!1);break;case"arrowStyle":t.toggleArrowStyle();break;case"screenshot":l.screenshot(e);break;case"commandshell":l.terminal(e);break;default:throw"Element ID unrecognized"}return!1},liveSearch:e=>{let t=$(".helpsearch input"),s=t.val(),a=!1;if("Escape"===e.code)return e.preventDefault(),t.val("").blur(),l.clearClicks(!0),!0;if("Enter"!==e.code&&"Return"!==e.code||(e.preventDefault(),$(".persist").removeClass("persist"),a=!0),s.length<2)return l.clearClicks(!1),!0;let o=r.find(s);return o?(l.clearClicks(!1),o.parents("li")&&o.parents("li").addClass("clicked"),o.addClass("clicked last"),a&&(t.blur(),o.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):l.clearClicks(!1),!0},focusSearch:e=>{e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),l.clearClicks();let t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1}}}(),a={orderedMenuItemTitles:[],init:()=>{r.getOrderedMenuItemTitles(),e.getBool("darkMode")&&l.setDarkMode(!0),e.getBool("expose")&&l.setExpose(!0),l.loadWallpaper(),e.getBool("bgImage")&&l.setBG(!0),t.setArrowStyle(e.get("arrowStyle")),$("body,li").on("click dblclick",s.itemClick),$("span",".controls").on("click",s.controlsClick),$(".helpsearch input").on("keyup",s.liveSearch),$(".helpsearch").on("click",s.focusSearch),$(".helpsearch").on("blur",(()=>{$(".persist").removeClass("persist")})),"ttscoff.github.io"===window.location.host&&$("body").addClass("demo"),Mousetrap.bind("shift+/",s.focusSearch),Mousetrap.bind("shift+d",l.toggleDarkMode),Mousetrap.bind("shift+e",l.toggleExpose),Mousetrap.bind("shift+s",l.screenshot),Mousetrap.bind("$",l.terminal)},click:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&l.clearClicks(!0),!e||/^\s*$/.test(e))return void l.clearClicks(!0);let t=r.find(e);t&&(t.click(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))},dblClick:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&l.clearClicks(!0),!e||/^\s*$/.test(e))return void l.clearClicks(!0);let t=r.find(e);t&&(t.dblclick(),t.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}},o={targetEl:null,getConfig:function(){return e.get()},config:function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=e.config,a=$.extend({},s,r);return l.setDarkMode(e.truthy(a.darkMode)),l.setBG(e.truthy(a.bgImage)),l.setWallpaper(a.wallpaper),t.setArrowStyle(a.arrowStyle),this},find:function(e){return this.targetEl=r.find(e),this},clear:function(){return l.clearClicks(!0),this},lock:function(){return l.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),l.clearClicks(!0),e&&(this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout")),this},arrow:function(e){return void 0===e&&(e=!0),t.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),t.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),l.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),l.setExpose(e),this},shoot:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return l.screenshot(!1,e),this}};$((function(){a.init(),window.NiftyAPI=o}))}();