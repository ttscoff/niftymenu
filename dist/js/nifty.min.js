"use strict";var Prefs=function(){var e={arrowStyle:"arrow",bgimage:1,expose:0,darkmode:0},t=null,r=function(r){var s=function(){if(!t){var r=JSON.parse(localStorage.getItem("niftyPrefs"));t=r?$.extend({},e,r):e,localStorage.setItem("niftyPrefs",JSON.stringify(t))}return t}();return s&&r?s.hasOwnProperty(r)?t[r]:null:s};return{config:t,set:function(e,s){(t=r())[e]=s,localStorage.setItem("niftyPrefs",JSON.stringify(t))},get:r,getBool:function(e){var t=r(e);return Number(t)?Boolean(Number(t)):!!/(y(es)?|true)/i.test(t)}}}(),Nifty=function(){var e=function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var r,s=t(),l=fuzzysort.go(e,s);return l.length?(r=l[0].target,$("li").filter((function(e,t){return $(t).data("path")===r})).first()):null},t=function(){if(k.orderedMenuItemTitles.length>0)return k.orderedMenuItemTitles;var e=[];return $("li").each((function(t,r){var s=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(s=t.innerText.split(/\n/)[0].trim()+"/"+s)})),$(r).data("path",s),e.push(s)})),k.orderedMenuItemTitles=e,k.orderedMenuItemTitles},r=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),l(!1);var s=Prefs.get("arrowStyle")||"arrow",a=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+s+" clicked "+a).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},s=function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?r(!1,e):(r(!1),l(!1),r(!0,e))):r(!1)},l=function e(t,s){s||t?(s instanceof jQuery||(s=$(s)),"LI"!==s.get(0).tagName&&(s=s.parents("li").first()),t?(e(!1),r(!1),$(".clicked").removeClass("clicked"),s.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),s.parents("li").addClass("clicked")):s.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},a=function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?l(!1,e):(l(!1),l(!0,e))):l(!1)},o=function(e){if(!(e instanceof jQuery))if("string"==typeof e){var t=k.fuzzyFind(e);if(!t)return!1;e=t}else e=$(e);return e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},i=function(){return setTimeout((function(){$(".last").length?$("body").addClass("locked"):$("body").removeClass("locked")}),50),!0},c=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),Prefs.set("arrowStyle",t)},n=function(){var e;"circle"===Prefs.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),c(e)},d=function(){var e=$("body");e.hasClass("bgimage")?(e.removeClass("bgimage"),Prefs.set("bgimage",0)):(e.addClass("bgimage"),Prefs.set("bgimage",1))},u=function(){var e=$("body");$("body").hasClass("dark")?(e.removeClass("dark"),Prefs.set("darkmode",0)):(e.addClass("dark"),Prefs.set("darkmode",1))},f=function(){var e=$("body");e.hasClass("expose")?(e.removeClass("expose"),Prefs.set("expose",0)):(e.addClass("expose"),Prefs.set("expose",1))},g=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),r(!1),l(!1),e&&$(".persist").removeClass("persist")},k={orderedMenuItemTitles:[],init:function(){t(),Prefs.get()},click:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&k.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=k.fuzzyFind(e);r&&(r.click(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else k.util.clearClicks(!0)},dblClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&k.util.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=k.fuzzyFind(e);r&&(r.dblclick(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else k.util.clearClicks(!0)},fuzzyFind:e,callout:{setArrow:r,setArrowStyle:c,toggleArrowStyle:n,toggleArrow:s,toggleCheckmark:o,setShortcut:l,toggleShortcut:a},handlers:{itemClick:function(e){e.preventDefault();var t,c=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(c=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?o(t):e.altKey&&(c?a(t):s(t)),i(),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),r(!1),l(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(g(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),r(!1),l(!1),i()),!1;r(!1),l(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&r(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return i(),!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":u();break;case"exposeToggle":f();break;case"backgroundToggle":d();break;case"arrowStyle":n();break;default:console.info("Element ID unrecognized")}return!1},liveSearch:function(t){var r=$(".helpsearch input"),s=r.val(),l=!1;if("Escape"===t.code)return t.preventDefault(),r.val("").blur(),g(!0),!0;if("Enter"!==t.code&&"Return"!==t.code||(t.preventDefault(),$(".persist").removeClass("persist"),l=!0),s.length<2)return g(!1),!0;var a=e(s);return a?(g(!1),a.parents("li").addClass("clicked"),a.addClass("clicked last"),l&&(r.blur(),a.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):g(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),g();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1},updateStatus:i},util:{setDarkMode:function(e){var t=$("body");e?t.addClass("dark"):t.removeClass("dark")},toggleDarkMode:u,setExpose:function(e){var t=$("body");e?t.addClass("expose"):t.removeClass("expose")},toggleExpose:f,setBG:function(e){var t=$("body");e?t.addClass("bgimage"):t.removeClass("bgimage")},toggleBG:d,clearClicks:g}};return k}();$((function(){Nifty.init(),Prefs.getBool("darkmode")&&Nifty.util.toggleDarkMode(),Prefs.getBool("expose")&&Nifty.util.toggleExpose(),Prefs.getBool("bgimage")&&Nifty.util.toggleBG(),Nifty.callout.setArrowStyle(Prefs.get("arrowStyle")),$("body,li").on("click dblclick",Nifty.handlers.itemClick),$("span",".controls").on("click",Nifty.handlers.controlsClick),$(".helpsearch input").on("keydown",Nifty.handlers.liveSearch),$(".helpsearch").on("click",Nifty.handlers.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),Mousetrap.bind("shift+/",Nifty.handlers.focusSearch),Mousetrap.bind("shift+d",Nifty.util.toggleDarkMode),Mousetrap.bind("shift+e",Nifty.util.toggleExpose)}));