!function(){"use strict";var e,t,r,a,l,s,o,c,n,i,d,u,g,h,f,p,k,m,v=(e={arrowStyle:"arrow",bgImage:1,expose:0,darkMode:0,wallpaper:"default"},a=function(r){var a=function(){if(!t){var r=JSON.parse(localStorage.getItem("niftyPrefs"));t=r?$.extend({},e,r):e,localStorage.setItem("niftyPrefs",JSON.stringify(t))}return t}();return a&&r?a.hasOwnProperty(r)?t[r]:null:a},{config:t=null,set:function(e,r){(t=a())[e]=r,localStorage.setItem("niftyPrefs",JSON.stringify(t))},get:a,getBool:function(e){var t=a(e);return r(t)},truthy:r=function(e){return"boolean"==typeof e?e:Number(e)?Boolean(Number(e)):!!/(y(es)?|true)/i.test(e)}}),C=(l=function e(t,r){if(r||t)if(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t){e(!1),s(!1);var a=v.get("arrowStyle")||"arrow",l=r.find("ul").length?"left":"right";$(".clicked").removeClass("clicked"),r.addClass("arrow arrow-"+a+" clicked "+l).append("<b><i></i></b>"),r.parents("li").addClass("clicked")}else r.removeClass("arrow arrow-arrow arrow-circle").find("b").remove();else $(".arrow").each((function(t,r){e(!1,$(r))}))},s=function e(t,r){r||t?(r instanceof jQuery||(r=$(r)),"LI"!==r.get(0).tagName&&(r=r.parents("li").first()),t?(e(!1),l(!1),$(".clicked").removeClass("clicked"),r.addClass("clicked").find(".shortcut").addClass("shortcut-callout"),r.parents("li").addClass("clicked")):r.find(".shortcut").removeClass("shortcut-callout")):$(".shortcut-callout").each((function(t,r){e(!1,$(r))}))},{setArrow:l,setArrowStyle:o=function(e){var t="arrow";e&&"circle"===e?(t="circle",$(".arrow-arrow").removeClass("arrow-arrow").addClass("arrow-circle")):$(".arrow-circle").removeClass("arrow-circle").addClass("arrow-arrow"),v.set("arrowStyle",t)},toggleArrowStyle:function(){var e;"circle"===v.get("arrowStyle")?(e="arrow",$("#arrowStyle",".controls").text("Arrow style: Arrow")):(e="circle",$("#arrowStyle",".controls").text("Arrow style: Circle")),o(e)},toggleArrow:function(e){e?(e instanceof jQuery||(e=$(e)),e.hasClass("arrow")?l(!1,e):(l(!1),s(!1),l(!0,e))):l(!1)},toggleCheckmark:function(e){return e instanceof jQuery||(e=$(e)),e.hasClass("checked")?e.removeClass("checked"):e.addClass("checked"),!0},setShortcut:s,toggleShortcut:function(e){e?(e instanceof jQuery||(e=$(e)),e.has(".shortcut-callout").length?s(!1,e):(s(!1),s(!0,e))):s(!1)}}),b=(n=function(){var e=v.get("wallpaper");e&&"default"!==e||(e=v.getBool("darkMode")?"images/darkbackground.jpg":"images/background.jpg"),i("body.bgimage {background-image: url("+e+")}")},i=function(e){var t;((t=document.createElement("style")).appendChild(document.createTextNode("")),document.head.appendChild(t),t.sheet).insertRule(e)},{setDarkMode:u=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=$("body");e?(t.addClass("dark"),v.set("darkMode",1)):(t.removeClass("dark"),v.set("darkMode",0))},toggleDarkMode:function(){var e=$("body").hasClass("dark");u(!e)},setExpose:g=function(e){var t=$("body");e?(t.addClass("expose"),v.set("expose",1)):(t.removeClass("expose"),v.set("expose",0))},toggleExpose:function(){$("body").hasClass("expose")?g(!1):g(!0)},setBG:d=function(e){var t=$("body");e?(t.addClass("bgimage"),v.set("bgImage",1),n()):(t.removeClass("bgimage"),v.set("bgImage",0))},setWallpaper:function(e){v.set("wallpaper",e),n()},loadWallpaper:n,toggleBG:function(){$("body").hasClass("bgimage")?d(!1):d(!0)},clearClicks:c=function(e){$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),C.setArrow(!1),C.setShortcut(!1),e&&$(".persist").removeClass("persist")},screenshot:function(e){$("body").addClass("screenshot");var t=$(".clicked");if(!t.length)throw"No menu items selected";var r=[];t.each((function(e,t){r.push($(t).find(">strong").text())}));var a=t.last();a.children(".shortcut").length>0?r.push(a.find(".menuitem").text()):r.push(a.text()),r=r.join("-").replace(/-+/g,"-").replace(/ +/g,"_");var l=t.parents("ul").not("body>ul"),s=Math.floor(t.first().offset().left-50),o=150,n=0;l.each((function(e,t){o+=$(t).width();var r=$(t).offset().top,a=$(t).height();r+a>n&&(n=r+a)}));var i=!1,u=v.getBool("bgImage");/url\("http/.test($("body").css("background-image"))?i=!0:/url\("file/.test($("body").css("background-image"))&&d(!1),html2canvas(document.querySelector("body"),{x:s,y:0,width:o,height:n+50,useCORS:i,allowTaint:!1}).then((function(t){if($("#screenshotHolder").empty(),$("#screenshotHolder").append(t),c(!0),$("body").removeClass("screenshot"),d(u),e){var a=$("<div class=screenshot-controls>");$("<button>Cancel</button>").addClass("screenshot-close").on("click",(function(){$("#screenshotHolder").empty()})).appendTo(a),$("<button>Save</button>").addClass("screenshot-dl").data("title",r).on("click",(function(){h(r)})).appendTo(a),a.appendTo("#screenshotHolder")}else h(r)}))},downloadScreenshot:h=function(e){e||(e="NiftyMenu_Screenshot");var t=document.querySelector("#screenshotHolder canvas"),r=document.createElement("a");r.download="".concat(e,".png"),r.href=t.toDataURL("image/png").replace("image/png","image/octet-stream"),r.click(),$("#screenshotHolder").empty()}}),w={orderedMenuItemTitles:[],getOrderedMenuItemTitles:p=function(){if(f&&f.length>0)return f;var e=[];return $("li").each((function(t,r){var a=r.innerText.split(/\n/)[0].trim();$(r).parents("li").each((function(e,t){t.innerText.length&&(a=t.innerText.split(/\n/)[0].trim()+"/"+a)})),$(r).data("path",a),e.push(a)})),f=e},find:function(e){if(/^\s*$/.test(e))return null;e=e.replace(/>/g,"/");var t,r=p(),a=fuzzysort.go(e,r);return a.length?(t=a[0].target,$("li").filter((function(e,r){return $(r).data("path")===t})).first()):null}},y=(k=function(){var e=prompt("Enter URL for background image");v.set("wallpaper",e),b.loadWallpaper()},m=function(){var e=prompt("Enter optional keywords (comma separated words)"),t="https://source.unsplash.com/random/1900x1200?"+encodeURIComponent(e);v.set("wallpaper",t),b.loadWallpaper()},{itemClick:function(e){e.preventDefault();var t,r=!1;if("SPAN"===e.target.tagName?(t=$(e.target).closest("li"),$(e.target).hasClass("shortcut")&&(r=!0)):t=$(e.target),e.metaKey||e.altKey)return e.metaKey?C.toggleCheckmark(t):e.altKey&&(r?C.toggleShortcut(t):C.toggleArrow(t)),!1;if($(".callout").removeClass("callout"),$(".persist").removeClass("persist"),"BODY"===e.target.tagName)$(".clicked").removeClass("clicked"),$(".last").removeClass("last"),C.setArrow(!1),C.setShortcut(!1);else{if(t.hasClass("clicked"))return t.find(".last").length?(b.clearClicks(),t.parents("li").addClass("clicked"),t.addClass("clicked last")):($(".last").removeClass("last"),t.parents(".clicked").length?(t.removeClass("clicked"),t.siblings(".clicked").removeClass("clicked"),t.parents(".clicked").first().addClass("last")):$(".clicked").removeClass("clicked"),C.setArrow(!1),C.setShortcut(!1)),!1;C.setArrow(!1),C.setShortcut(!1),$("li.clicked").removeClass("clicked"),$(".last").removeClass("last"),t.parents("li").addClass("clicked"),e.altKey&&C.setArrow(!0,t),t.addClass("clicked last"),"dblclick"===e.type&&(t.addClass("callout"),e.shiftKey&&t.parents(".clicked").addClass("callout"))}return!1},controlsClick:function(e){switch(e.preventDefault(),e.target.id){case"darkModeToggle":b.toggleDarkMode();break;case"exposeToggle":b.toggleExpose();break;case"backgroundToggle":b.toggleBG();break;case"chooseWallpaper":k();break;case"randomWallpaper":m();break;case"resetWallpaper":b.setWallpaper(!1);break;case"arrowStyle":C.toggleArrowStyle();break;case"screenshot":b.screenshot(e);break;default:throw"Element ID unrecognized"}return!1},liveSearch:function(e){var t=$(".helpsearch input"),r=t.val(),a=!1;if("Escape"===e.code)return e.preventDefault(),t.val("").blur(),b.clearClicks(!0),!0;if("Enter"!==e.code&&"Return"!==e.code||(e.preventDefault(),$(".persist").removeClass("persist"),a=!0),r.length<2)return b.clearClicks(!1),!0;var l=w.find(r);return l?(b.clearClicks(!1),l.parents("li")&&l.parents("li").addClass("clicked"),l.addClass("clicked last"),a&&(t.blur(),l.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"center"}))):b.clearClicks(!1),!0},focusSearch:function(e){e.preventDefault(),$("li.callout").removeClass("callout"),$(".clicked").removeClass("clicked"),b.clearClicks();var t=$(".helpsearch").first();return t.parents("li").addClass("clicked persist"),t.get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),$("input",t).focus(),!1}}),S={orderedMenuItemTitles:[],init:function(){w.getOrderedMenuItemTitles(),v.getBool("darkMode")&&b.setDarkMode(!0),v.getBool("expose")&&b.setExpose(!0),b.loadWallpaper(),v.getBool("bgImage")&&b.setBG(!0),C.setArrowStyle(v.get("arrowStyle")),$("body,li").on("click dblclick",y.itemClick),$("span",".controls").on("click",y.controlsClick),$(".helpsearch input").on("keydown",y.liveSearch),$(".helpsearch").on("click",y.focusSearch),$(".helpsearch").on("blur",(function(){$(".persist").removeClass("persist")})),"ttscoff.github.io"===window.location.host&&$("body").addClass("demo"),Mousetrap.bind("shift+/",y.focusSearch),Mousetrap.bind("shift+d",b.toggleDarkMode),Mousetrap.bind("shift+e",b.toggleExpose),Mousetrap.bind("shift+s",b.screenshot)},click:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&b.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=w.find(e);r&&(r.click(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else b.clearClicks(!0)},dblClick:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&b.clearClicks(!0),e&&!/^\s*$/.test(e)){var r=w.find(e);r&&(r.dblclick(),r.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}))}else b.clearClicks(!0)}},x={targetEl:null,config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=v.config,r=$.extend({},t,e);return b.setDarkMode(v.truthy(r.darkMode)),b.setExpose(v.truthy(r.expose)),b.setBG(v.truthy(r.bgImage)),b.setWallpaper(r.wallpaper),C.setArrowStyle(r.arrowStyle),this},find:function(e){return this.targetEl=S.find(e),this},clear:function(){return b.clearClicks(!0),this},lock:function(){return b.clearClicks(!0),this.targetEl.click(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),this},callout:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return void 0===e&&(e=!0),b.clearClicks(!0),this.targetEl.dblclick(),this.targetEl.get(0).scrollIntoView({behavior:"auto",block:"end",inline:"center"}),t&&this.targetEl.parents(".clicked").addClass("callout"),this},arrow:function(e){return void 0===e&&(e=!0),C.setArrow(e,this.targetEl),this},shortcut:function(e){return void 0===e&&(e=!0),C.setShortcut(e,this.targetEl),this},darkMode:function(e){return void 0===e&&(e=!0),b.setDarkMode(e),this},expose:function(e){return void 0===e&&(e=!0),b.setExpose(e),this},shoot:function(){return b.screenshot(),this}};$((function(){S.init(),window.NiftyAPI=x}))}();